#K线形态分析

<span id='pattern'/>

###形态编码识别
人可以通过图表的形式识别出K线形态，比如“三朵乌云”，“十字线”·····,但在量化投资中是由计算机来做交易，计算怎么识别这些形态呢。
这就是需要对K线进行编码，把一串K线数据编码成一个编码值。

#####KPattern
KPattern就是把一段bar串编码为一个映射值，相同的K线形态的映射值是一样的。如下：

+ encode_2k_by_algo1: 编码2日k线形态
+ encode_3k_by_algo1: 编码3日k线形态

但需要说明的是，KPattern的编码映射算法是有好与坏的，可能映射算法过于离散，并不能好好的聚合一些形态，但又不能太聚合。所以好的编码算法是介于聚合有离散之间。那怎么衡量一个好的编码算法是否好呢？

#####anaylsisPatternCoverity
可以通过anaylsisPatternCoverity函数去统计编码映射算法的覆盖率，在满足设定的覆盖率的情况下提取有意义的形态识别映射值。

函数参数:
+ bar_source : K线行情资源
+ calc_pattern_value : k线形态识别函数，他是形似fun xxxx(bars:[])->int: 的一个Callable  
+ min_coverity_rate : 最小覆盖率，识别的形态个数只要满足这个覆盖率就说明该映射值是达到要求的，一般为0.05%到0.1%之间

例子: 使用encode_2k_by_algo1编码统计中证500行情形态在最小覆盖率为0.1%的情况。

代码:
```python
app = App()
start = datetime(year=2018,month=1,day=6)
end = datetime(year=2021,month=1,day=6)
drvier2 = ZZ500StockDriver()
bar_source = app.getBarManager().createBarSoruce(drvier2, start, end)

def calc_pattern_value(bars:Sequence['BarData'])->int:
    return KPattern.encode_2k_by_algo1(bars)

anaylsisPatternCoverity(bar_source,calc_pattern_value,min_coverity_rate=0.001)
```

日志输出:

    发生总共347013个形态识别事件，设定的最小满足覆盖率0.1% = 347
    满足最小覆盖率的形态个数:75, 最终覆盖率为:18.741949148879147%
    各个形态的个数分布为: ,[353.00:783.87)=58.67%,[783.87:1214.73)=25.33%,[1645.60:2076.47)=6.67%,[1214.73:1645.60)=5.33%,[2076.47:2507.33)=1.33%,other=2.67%
    满足形态的模式值: [206671, 265649, 213961, 265639, 265720, 206580, 324769, 81283, 265629, 29443, 206590, 206337, 199381, 265619, 259159, 265963, 265376, 
    442867, 14944, 265710, 258430, 265719, 280300, 206428, 265801, 265467, 81040, 36814, 21991, 251140, 265477, 88330, 88492, 95863, 265497, 265740, 265711, 
    265487, 88482, 199138, 199300, 265638, 88320, 206347, 88573, 22234, 206681, 258420, 279571, 265730, 273010, 266449, 205942, 265386, 265721, 272281, 265729, 265406,
    273020, 192091, 265457, 273000, 251869, 88563, 258187, 103153, 221251, 258440, 73993, 264991, 258349, 265700, 265659, 272919, 272929]

可以看出，使用encode_2k_by_algo1编码算法的总覆盖率为18.74%是可以得到要求的，而上面的计算出来的75个形态也是可以作为有研究意义的形态。因为这几个形态处于不过于聚合有不过与离散，且
覆盖率又说明是容易产生的概率，是可以作为量化计算的。

至于这75有意义的个形态编码值，后续如何做分析，可以参考下面这篇文章。
[encode_2k_by_algo1形态编码算法的涨幅分析](案例/encode_2k_by_algo1形态编码算法的涨幅分析.md)

<span id='analysis'/>

###形态分析
